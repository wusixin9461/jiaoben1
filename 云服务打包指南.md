# PokeMMO自动化 - 云服务打包指南

由于在Windows环境下直接配置Android打包环境较为复杂，本指南提供两种简单的云服务打包方法，无需在本地安装复杂的开发环境。

## 方法一：使用Google Colab（推荐）

Google Colab提供免费的云计算资源，可以轻松进行Android应用打包。

### 步骤：

1. **准备项目文件**
   - 确保您的项目文件夹包含以下文件：
     - `pokemmo_automation_android.py`（Android版本主程序）
     - `buildozer.spec`（Buildozer配置文件）
     - `requirements_kivy.txt`（依赖列表）

2. **上传文件到Google Drive**
   - 访问 https://drive.google.com
   - 登录您的Google账号
   - 创建一个新文件夹，例如命名为"PokeMMOAutomation"
   - 将上述三个文件上传到该文件夹

3. **打开Google Colab**
   - 访问 https://colab.research.google.com/
   - 登录同一个Google账号
   - 点击"新建笔记本"

4. **运行以下代码块**（依次复制粘贴并运行）：

   **步骤1：挂载Google Drive**
   ```python
   from google.colab import drive
   drive.mount('/content/drive')
   ```
   - 运行后会出现链接，点击链接授权访问您的Google Drive
   - 复制授权码并粘贴到输入框中

   **步骤2：进入项目文件夹**
   ```python
   %cd /content/drive/MyDrive/PokeMMOAutomation
   ```

   **步骤3：安装必要的工具和依赖**
   ```python
   !pip install buildozer
   !apt-get update
   !apt-get install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
   ```

   **步骤4：开始打包过程**
   ```python
   !buildozer -v android debug
   ```

5. **等待打包完成**
   - 首次打包会下载大量依赖，可能需要30分钟到1小时
   - 请确保Colab页面保持打开状态

6. **下载APK文件**
   - 打包完成后，在左侧文件浏览器中展开文件夹
   - 找到`bin`文件夹，里面会有生成的APK文件（文件名类似`pokemmo自动化-0.1-debug.apk`）
   - 右键点击APK文件，选择"下载"

## 方法二：使用GitHub Actions

如果您熟悉Git和GitHub，可以使用免费的GitHub Actions服务进行自动化打包。

### 步骤：

1. **创建GitHub账户**
   - 访问 https://github.com/join
   - 注册一个免费账户

2. **创建新仓库**
   - 登录后，点击右上角的"+"图标，选择"New repository"
   - 填写仓库名称（例如"pokemmo-automation"）
   - 选择"Public"（公共仓库）
   - 点击"Create repository"

3. **上传项目文件**
   - 在仓库页面，点击"Add file" -> "Upload files"
   - 上传以下文件：
     - `pokemmo_automation_android.py`
     - `buildozer.spec`
     - `requirements_kivy.txt`
   - 点击"Commit changes"

4. **创建GitHub Actions工作流文件**
   - 在仓库页面，点击"Add file" -> "Create new file"
   - 文件名输入：`.github/workflows/build-apk.yml`
   - 复制以下内容到文件中：

   ```yaml
   name: Build Android APK

   on:
     push:
       branches: [ main ]
     pull_request:
       branches: [ main ]
     workflow_dispatch:  # 允许手动触发

   jobs:
     build:
       runs-on: ubuntu-latest

       steps:
       - uses: actions/checkout@v3

       - name: Set up Python
         uses: actions/setup-python@v4
         with:
           python-version: '3.9'

       - name: Install dependencies
         run: |
           python -m pip install --upgrade pip
           pip install buildozer
           sudo apt-get update
           sudo apt-get install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev

       - name: Build APK
         run: buildozer -v android debug

       - name: Upload APK
         uses: actions/upload-artifact@v3
         with:
           name: pokemmo-automation-apk
           path: bin/*.apk
   ```
   - 点击"Commit new file"

5. **手动触发构建**
   - 在仓库页面，点击"Actions"选项卡
   - 点击左侧的"Build Android APK"
   - 点击"Run workflow"按钮，然后再次点击绿色的"Run workflow"按钮

6. **下载APK文件**
   - 构建完成后，点击最新的工作流运行
   - 向下滚动找到"Artifacts"部分
   - 点击"pokemmo-automation-apk"下载APK文件

## 常见问题解决

### Google Colab相关

1. **Colab会话超时**
   - 可以使用以下方法防止超时：
     - 每10-15分钟点击一次Colab页面
     - 打开浏览器控制台，运行以下代码：
       ```javascript
       function ClickConnect(){console.log("Working"); document.querySelector("colab-toolbar-button#connect").click();}
       setInterval(ClickConnect, 60000)
       ```

2. **内存不足错误**
   - 如果遇到内存不足，可以尝试：
     - 点击"Runtime" -> "Change runtime type"
     - 选择"High-RAM"选项
     - 点击"Save"
     - 重新运行所有代码块

### GitHub Actions相关

1. **构建失败**
   - 查看详细日志了解具体错误
   - 常见问题通常是依赖版本不兼容
   - 可以尝试修改buildozer.spec中的依赖版本

## 后续使用

1. **安装APK**
   - 将下载的APK文件传输到您的Android设备
   - 在设备上允许安装"未知来源"的应用
   - 点击APK文件进行安装

2. **应用权限**
   - 首次运行时，应用会请求相机、存储等权限
   - 请授予必要的权限以确保应用正常工作

3. **使用说明**
   - 应用界面提供了虚拟按钮用于控制游戏
   - 可以根据需要在设置中配置自动捕获的参数

祝您使用愉快！如有任何问题，请参考项目中的其他文档或搜索相关资源。